import{m as G,j as z,r as n}from"./index-Hwq3ryd1.js";const H=G("session",()=>{const a=n(null),d=n("zh"),r=n(null),l=n({A:null,B:null}),c=n([]),v=n([]),o=n({versionA:{},versionB:{},final:{preference:null,feedback:""}}),p=n("A"),g=n(null),y=n(null),u=n(0),m=n(!1),i=n(null);function h(){a.value=crypto.randomUUID(),r.value=Date.now();const e=Math.random()<.5;l.value={A:e?"GT":"Model",B:e?"Model":"GT"},console.log("Session initialized:",{userId:a.value,versionMapping:l.value})}function S(e,s=null){c.value.push({timestamp:Date.now(),genre:g.value,emotion:y.value,version:p.value,action:e,songId:s})}function x(e,s,t){v.value.push({songId:e,duration:s,completed:t,timestamp:Date.now()})}function k(){u.value++,S("analyze")}function B(e,s){const t=`version${p.value}`;o.value[t][e]=s}function C(e,s){o.value.final[e]=s}const D=z(()=>{const e=o.value.versionA,s=o.value.versionB,t=o.value.final,A=["discoverability","serendipity","coherence","satisfaction"],M=A.every(f=>e[f]!==void 0),T=A.every(f=>s[f]!==void 0),w=t.preference!==null;return M&&T&&w&&u.value>=3});function b(){return{userId:a.value,language:d.value,startTime:r.value,submittedAt:Date.now(),versionMapping:l.value,explorationLogs:c.value,playbackHistory:v.value,responses:o.value,explorationsCount:u.value}}async function I(){m.value=!0,i.value=null;try{const e=b(),s=JSON.parse(localStorage.getItem("submissions")||"[]");return s.push(e),localStorage.setItem("submissions",JSON.stringify(s)),i.value="success",!0}catch(e){return console.error("Submit error:",e),i.value="error",!1}finally{m.value=!1}}return{userId:a,language:d,startTime:r,versionMapping:l,explorationLogs:c,playbackHistory:v,responses:o,currentVersion:p,currentGenre:g,currentEmotion:y,explorationsCount:u,isSubmitting:m,submitStatus:i,isComplete:D,initSession:h,logExploration:S,logPlayback:x,trackExploration:k,setResponse:B,setFinalResponse:C,getSessionData:b,submitSession:I}});export{H as u};
